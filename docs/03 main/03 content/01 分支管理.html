<article class="doc-article">
<h1 id="分支管理">分支管理</h1>
<p><img src="./imgs/img45.png" /></p>
<h2 id="功能概述">功能概述</h2>
<p>分支管理是 TransX 中用于监控和管理 Git
版本控制系统下项目分支状态的核心功能。该功能通过实时检测项目所在 Git
分支的变化，确保 TransX 编辑环境与当前 Xcode
项目分支保持一致性，有效防止因外部分支切换导致的本地化内容混乱、数据覆盖和版本冲突等问题。</p>
<p>对于使用 Git
进行版本管理的多分支开发流程，此功能是保障本地化内容完整性和团队协作效率的重要机制。</p>
<h2 id="工作原理">工作原理</h2>
<h3 id="自动分支检测机制">自动分支检测机制</h3>
<p><strong>初始化检测</strong>：<br />
当 TransX 启动并加载 Xcode 项目时，系统会立即执行以下操作：</p>
<ul>
<li>自动识别项目是否使用 Git 版本控制</li>
<li>读取项目根目录的 <code>.git</code> 配置信息</li>
<li>检测并记录当前项目所在的 Git 分支名称</li>
<li>将分支信息存储到内部状态管理器中</li>
</ul>
<p><strong>动态监控机制</strong>：<br />
在应用运行期间，TransX 实现了智能的分支状态监控：</p>
<ul>
<li>每当应用窗口重新获得焦点（从后台切回前台）时自动触发检测</li>
<li>执行 Git 命令查询当前项目的实际分支状态</li>
<li>将检测到的分支与内部记录的分支进行对比</li>
<li>整个检测过程在后台异步执行，不会阻塞用户界面操作</li>
</ul>
<h3 id="分支不一致警告">分支不一致警告</h3>
<p>当检测到 Xcode 项目在 TransX
外部被切换到不同分支时，系统会立即采取以下保护措施：</p>
<p><strong>视觉警告机制</strong>：</p>
<ul>
<li>在内容区顶部显示醒目的<strong>红色警告条幅</strong></li>
<li>警告条幅会清晰指出当前项目所在分支与 TransX 记录的分支不匹配</li>
<li>条幅会持续显示，直到问题被解决或用户手动处理</li>
</ul>
<p><strong>警告信息内容</strong>：</p>
<ul>
<li><strong>记录的分支</strong>：TransX 内部记录的原始分支名称</li>
<li><strong>当前分支</strong>：项目实际所在的 Git 分支名称</li>
<li><strong>操作建议</strong>：提示用户可采取的解决方案</li>
</ul>
<p><strong>保护机制的价值</strong>：</p>
<p>此机制可以有效防止以下常见问题：</p>
<ol type="1">
<li><p><strong>内容错配风险</strong></p>
<ul>
<li>在错误的分支上编辑本地化文件</li>
<li>导致将一个分支的翻译内容误保存到另一个分支</li>
</ul></li>
<li><p><strong>数据覆盖风险</strong></p>
<ul>
<li>不同分支的 .strings 文件内容可能存在差异</li>
<li>在错误分支编辑后保存，可能覆盖该分支的原有内容</li>
<li>造成难以追溯的数据丢失</li>
</ul></li>
<li><p><strong>版本冲突风险</strong></p>
<ul>
<li>团队协作时，多人在不同分支工作</li>
<li>误操作可能导致分支合并时产生大量冲突</li>
<li>增加版本管理的复杂度和错误率</li>
</ul></li>
<li><p><strong>工作流混乱</strong></p>
<ul>
<li>开发人员在 feature 分支工作，却在 main 分支编辑了本地化</li>
<li>导致提交记录混乱，难以进行代码审查</li>
</ul></li>
</ol>
<p><strong>工作流保护示例</strong>：</p>
<pre><code>场景：开发人员正在 feature/new-login 分支工作

1. TransX 记录分支：feature/new-login
2. 开发人员在终端切换到 main 分支：git checkout main
3. 开发人员切回 TransX 窗口（窗口获得焦点）
4. TransX 自动检测到分支变化
5. 立即显示红色警告：&quot;项目已从 feature/new-login 切换到 main&quot;
6. 开发人员意识到错误，可以选择：
   - 在终端切回 feature/new-login 分支
   - 或在 TransX 中点击&quot;切换到当前分支&quot;同步到 main</code></pre>
<h3 id="分支恢复提示">分支恢复提示</h3>
<p>当用户将 Xcode 项目切换回 TransX 记录的原始分支时：</p>
<p><strong>自动恢复机制</strong>：</p>
<ul>
<li>红色警告条幅会<strong>自动消失</strong></li>
<li>表明分支状态已恢复一致</li>
<li>用户可以安全地继续编辑工作</li>
</ul>
<p><strong>状态同步</strong>：</p>
<ul>
<li>TransX 会再次验证当前分支与内部记录的一致性</li>
<li>确认文件状态与当前分支匹配</li>
<li>恢复正常的编辑模式</li>
</ul>
<h2 id="操作步骤">操作步骤</h2>
<h3 id="切换到当前分支">切换到当前分支</h3>
<p>当确认需要在新分支上工作时，可以通过以下步骤将 TransX
的工作环境同步到新分支：</p>
<p><strong>操作流程</strong>：</p>
<ol type="1">
<li><p><strong>识别警告</strong>：</p>
<ul>
<li>观察内容区顶部的红色警告条幅</li>
<li>确认当前项目所在分支与需求是否匹配</li>
<li>决定是切回原分支还是同步到新分支</li>
</ul></li>
<li><p><strong>确认意图</strong>：</p>
<ul>
<li>如果新分支是正确的工作目标，继续下一步</li>
<li>如果是误切换，建议在终端或 Git 工具中切回原分支</li>
<li><strong>重要</strong>：确认当前工作已保存，切换分支会重新加载文件</li>
</ul></li>
<li><p><strong>执行切换</strong>：</p>
<ul>
<li>点击红色警告条幅右侧的"切换到当前分支"按钮</li>
<li>系统会弹出二次确认对话框，提示可能的影响</li>
<li>确认后，TransX 开始执行分支切换流程</li>
</ul></li>
<li><p><strong>系统处理</strong>：</p>
<ul>
<li><strong>重新扫描</strong>：TransX 重新扫描当前 Xcode
项目的资源文件结构</li>
<li><strong>文件加载</strong>：重新加载新分支下的所有 .strings
文件内容</li>
<li><strong>状态更新</strong>：更新内部分支记录，与新分支保持同步</li>
<li><strong>缓存清理</strong>：清除旧分支相关的缓存数据</li>
<li><strong>界面刷新</strong>：刷新内容列表，显示新分支的本地化条目</li>
</ul></li>
<li><p><strong>验证结果</strong>：</p>
<ul>
<li>警告条幅消失，表示切换成功</li>
<li>内容列表显示新分支的实际内容</li>
<li>可以正常进行编辑和保存操作</li>
</ul></li>
</ol>
<p><strong>数据影响说明</strong>：</p>
<p>⚠️
<strong>重要提示</strong>：执行"切换到当前分支"操作会产生以下影响：</p>
<ul>
<li><strong>未保存内容丢失</strong>：所有未保存的编辑内容将会丢失，无法恢复</li>
<li><strong>视图重置</strong>：当前的筛选、搜索、排序状态会被重置</li>
<li><strong>文件结构变化</strong>：新分支可能包含不同的 .strings
文件</li>
<li><strong>内容差异</strong>：相同 Key
在不同分支可能有不同的翻译内容</li>
</ul>
<p><strong>操作前检查清单</strong>：</p>
<p>✅ 在执行切换前，请确认：</p>
<ul class="task-list">
<li><label><input
type="checkbox" />当前所有修改已保存（<code>Command + S</code>）</label></li>
<li><label><input
type="checkbox" />确认新分支是正确的工作目标</label></li>
<li><label><input
type="checkbox" />了解新分支与旧分支的内容差异</label></li>
<li><label><input
type="checkbox" />如有必要，已备份或提交当前工作</label></li>
<li><label><input
type="checkbox" />确认网络连接正常（如果项目在远程）</label></li>
</ul>
<p><strong>最佳实践</strong>：</p>
<ol type="1">
<li><strong>养成保存习惯</strong>：频繁保存工作，减少切换时的数据丢失风险</li>
<li><strong>分支工作隔离</strong>：尽量避免在工作中途频繁切换分支</li>
<li><strong>使用版本控制</strong>：定期提交本地化文件到
Git，便于恢复和追溯</li>
<li><strong>团队沟通</strong>：在切换分支前，与团队确认当前分支的工作状态</li>
</ol>
<h2 id="使用场景">使用场景</h2>
<h3 id="多分支开发">多分支开发</h3>
<p>在进行 feature 分支开发、hotfix
修复或版本维护时，不同分支可能有不同的本地化需求：</p>
<ul>
<li><strong>主分支（main/master）</strong>：包含稳定的生产环境翻译</li>
<li><strong>开发分支（develop）</strong>：包含正在开发的新功能文案</li>
<li><strong>功能分支（feature/*）</strong>：可能包含实验性或特定功能的本地化内容</li>
<li><strong>修复分支（hotfix/*）</strong>：针对紧急问题的文案修正</li>
</ul>
<h3 id="团队协作">团队协作</h3>
<p>在团队环境中，多人可能同时在不同分支上工作，分支管理功能可以：</p>
<ul>
<li>确保每个成员在正确的分支上编辑对应的本地化文件</li>
<li>避免分支合并时产生不必要的冲突</li>
<li>保持各分支本地化内容的独立性和完整性</li>
</ul>
<h2 id="注意事项">注意事项</h2>
<ol type="1">
<li><strong>Git 依赖</strong>：此功能仅在项目使用 Git
进行版本控制时可用，非 Git 项目不会显示分支相关信息</li>
<li><strong>外部切换</strong>：TransX
只能检测到在外部（如终端、SourceTree、Xcode
等）进行的分支切换，无法主动切换分支</li>
<li><strong>保存建议</strong>：在看到分支不一致警告时，建议先保存当前工作，再决定是否切换到新分支</li>
<li><strong>重新加载</strong>：切换到新分支后，所有未保存的编辑内容将会丢失，请务必提前保存</li>
<li><strong>文件差异</strong>：不同分支可能包含不同的 .strings
文件，切换分支后可用的本地化文件列表可能会发生变化</li>
</ol>

</article>
