# 通用设置

![](./imgs/img48.png)

通用设置用于配置 TransX 项目中的核心操作规则和行为模式，这些配置将影响整个项目的多语言管理流程。合理的通用设置能够显著提升团队协作效率，确保项目中 .strings 文件的一致性和规范性。

## strings 基础语言

基础语言（Base Language）是项目中所有 .strings 文件的参考语言，也是开发过程中的主要工作语言。

**配置说明：**

- **选择原则**：建议选择团队中最熟悉、最了解的语言，通常是母语或项目的主要开发语言
- **作用范围**：基础语言将作为翻译的源语言，其他语言版本都基于此语言进行翻译
- **团队协作**：统一的基础语言有助于团队内部沟通，减少因语言理解差异导致的翻译错误
- **Xcode 规范**：在 Xcode 项目中，基础语言通常对应项目的 Base 或 Development Language

**最佳实践：**

- 对于中国团队，建议选择中文（简体）作为基础语言
- 对于国际化项目，建议选择英语作为基础语言，因为英语是最通用的开发语言
- 一旦确定基础语言，不建议中途更改

## 去除空白字符

空白字符是指在文本中不可见但可能影响内容展示或行为的字符。在 .strings 文件管理中，隐藏的空白字符是导致本地化问题的常见原因之一。

**空白字符分类：**

1. **可见空白字符**（开发中正常使用）：
   - 普通空格（U+0020，0x0020）
   - 制表符（U+0009，0x0009，`\t`）
   - 换行符（U+000A，0x000A，`\n`）
   - 回车符（U+000D，0x000D，`\r`）

2. **隐藏空白字符**（可能导致问题）：
   - 零宽空格（U+200B，Zero Width Space）
   - 不间断空格（U+00A0，Non-Breaking Space）
   - 窄不间断空格（U+202F，Narrow No-Break Space）
   - 全角空格（U+3000，Ideographic Space）
   - 零宽不连字（U+200C，Zero Width Non-Joiner）
   - 零宽连字（U+200D，Zero Width Joiner）

**隐藏空白字符的危害：**

- **字符串比较失败**：两个看起来相同的字符串因隐藏字符而无法匹配
- **Key 查找失败**：本地化 key 中的隐藏字符导致无法正确加载翻译内容
- **界面显示异常**：文本布局、对齐出现意外的空白区域
- **数据解析错误**：JSON、XML 等格式解析时产生意外结果
- **代码编译警告**：某些编译器可能对不可见字符发出警告

**功能说明：**

启用此功能后，TransX 将自动执行以下操作：

1. **项目启动时**：自动扫描并清理所有 .strings 文件和常量文件中的隐藏空白字符
2. **编辑过程中**：实时检测新增或修改的内容，自动清理隐藏空白字符
3. **日志记录**：所有清理操作都会记录在日志区域，包括：
   - 检测到的隐藏字符类型和位置
   - 清理的文件名和行号

**最佳实践：**

- **建议始终启用**：特别是在团队协作项目中，不同编辑器可能引入各种隐藏字符
- **定期检查日志**：关注是否频繁出现隐藏字符，如果是，需要排查字符来源（如复制粘贴、特定编辑器等）
- **编辑器配置**：在文本编辑器中启用"显示不可见字符"选项，便于在编辑时发现问题，如在sublime中
- **代码审查**：在代码审查时，特别注意检查字符串内容的完整性

## Key、常量替换提示

在维护大型项目的本地化内容时，Key 或常量的重命名是常见的需求。TransX 提供智能替换提示功能，帮助您安全、高效地完成重构工作。

**功能说明：**

当您在 TransX 中修改本地化字符串的 Key 或对应的常量名称时，系统会：

1. **自动检测变更**：实时监测 Key 或常量名称的修改操作
2. **扫描代码引用**：在代码目录中搜索所有使用该 Key 或常量的位置
3. **智能提示**：弹出确认对话框，提示修改
4. **批量替换**：确认后自动在所有引用位置进行替换
5. **操作日志**：记录所有替换操作，支持追溯和回滚

**应用场景：**

- **重构本地化 Key**：优化 Key 命名规范，使其更具语义化
- **重命名常量**：统一常量命名风格，符合代码规范
- **合并重复内容**：将多个相同含义的 Key 合并为一个
- **删除废弃内容**：在删除本地化内容前，确认代码中没有遗留引用

**最佳实践：**

- **启用此功能**：强烈建议在团队项目中启用，避免因手动替换遗漏导致的运行时错误
- **替换前备份**：虽然 TransX 提供操作记录，但建议在大规模替换前提交代码或创建分支
- **验证替换结果**：替换完成后，检查日志确认所有引用都已正确更新
- **注意作用域**：替换操作仅在配置的代码目录范围内执行，确保目录配置正确
- **测试运行**：替换完成后，运行项目的单元测试和 UI 测试，确保功能正常

**注意事项：**

- 此功能依赖于"文件夹 - 代码"配置，确保已正确设置代码目录范围
- 对于动态生成的 Key（如通过字符串拼接），无法自动检测和替换，需手动处理
- 替换操作是不可自动撤销的，请谨慎确认后再执行

## Key 前缀

Key 前缀是本地化管理中的重要规范，合理的前缀设计能够提升代码的可维护性和可读性。TransX 支持为新建的本地化字符串自动添加预设的 Key 前缀。

**配置说明：**

设置 Key 前缀后，在新建本地化字符串时，输入框会自动填充该前缀，您只需填写后续的具体内容即可。

**命名规范示例：**

1. **反向域名风格**（推荐）：
   ```
   com.company.app.feature.action
   com.auu.localization.about
   com.auu.localization.settings.language
   com.auu.localization.error.networkFailure
   ```

2. **模块分层风格**：
   ```
   app.module.feature.description
   app.user.profile.title
   app.user.profile.saveButton
   app.settings.privacy.description
   ```

3. **功能分组风格**：
   ```
   ui.button.confirm
   ui.button.cancel
   ui.label.username
   message.error.invalidInput
   message.success.saved
   ```

**前缀设计原则：**

1. **层级清晰**：使用点号（`.`）分隔不同层级，从通用到具体
2. **语义明确**：前缀应能清晰表达字符串的所属模块或功能
3. **保持一致**：整个项目使用统一的前缀风格
4. **避免过长**：平衡语义清晰度和输入便捷性，建议 2-4 层
5. **使用小写**：统一使用小写字母和点号，避免大小写混用

**前缀的优势：**

- **命名空间隔离**：避免不同模块间的 Key 冲突
- **快速定位**：通过前缀快速识别字符串的归属
- **便于搜索**：使用前缀作为关键词快速查找相关内容
- **团队协作**：统一的命名规范减少沟通成本

**最佳实践：**

- 在项目初期就确定 Key 前缀规范，并在团队中推广
- 将 Key 前缀规范写入项目文档，确保所有团队成员遵守
- 定期检查是否有违反规范的 Key，及时修正
- 对于小型项目，可以使用简化的前缀，如 `app.` 或 `loc.`
- 对于多模块大型项目，建议使用反向域名风格，清晰区分不同模块

## Key 校验正则

Key 校验正则表达式用于强制执行项目的 Key 命名规范，确保所有本地化 Key 符合统一的格式要求。这在团队协作中尤为重要，能够有效避免因命名不规范导致的维护问题。

**功能说明：**

配置 Key 校验正则后，TransX 会在以下时机自动执行校验：

1. **保存时校验**：在编辑区每次保存本地化内容时
2. **新建时校验**：创建新的本地化字符串时
3. **导入时校验**：从外部导入 .strings 文件时
4. **批量操作校验**：执行批量修改操作时

如果 Key 不符合正则规则，系统会：
- 阻止保存操作
- 显示错误提示信息
- 提示不符合规范的 Key

**常用正则表达式示例：**

1. **反向域名风格**（仅小写字母、数字和点）：
   ```regex
   ^[a-z][a-z0-9]*(\.[a-z][a-z0-9]*)*$
   ```
   匹配：`com.company.app.button.ok`
   不匹配：`Com.Company.App`、`com.company..app`

2. **驼峰命名风格**：
   ```regex
   ^[a-z][a-zA-Z0-9]*$
   ```
   匹配：`buttonOk`、`errorMessage`
   不匹配：`ButtonOk`、`button_ok`

3. **下划线分隔风格**：
   ```regex
   ^[a-z][a-z0-9_]*[a-z0-9]$
   ```
   匹配：`button_ok`、`error_message`
   不匹配：`_button`、`button_`

4. **带前缀的点分隔风格**：
   ```regex
   ^app\.[a-z][a-z0-9]*(\.[a-z][a-z0-9]*)*$
   ```
   匹配：`app.settings.language`
   不匹配：`settings.language`、`app..settings`

5. **允许中划线的风格**：
   ```regex
   ^[a-z][a-z0-9-]*(\.[a-z][a-z0-9-]*)*$
   ```
   匹配：`ui.button-primary.text`
   不匹配：`ui.-button`、`ui.button-`

**校验规则设计原则：**

- **严格但不过度**：规则应该严格到能避免常见错误，但不要过于苛刻导致开发效率降低
- **符合语言习惯**：考虑团队使用的编程语言的命名习惯
- **禁止特殊字符**：明确禁止 `#$%^&*()+=[]{}|\\:;"'<>,?/` 等特殊字符
- **禁止空格**：Key 中不应包含空格字符
- **长度限制**：建议通过正则限制 Key 的最大长度，避免过长（如限制在 100 字符以内）

**最佳实践：**

- **项目初期制定**：在项目开始时就确定 Key 命名规范和对应的正则表达式
- **团队培训**：确保所有团队成员理解并掌握 Key 命名规范
- **文档化**：将正则表达式和命名规范写入项目文档，并提供正反示例
- **渐进式引入**：对于现有项目，可以先使用宽松的规则，逐步严格化
- **定期检查**：定期使用 TransX 扫描项目，检查是否有不符合规范的 Key
- **正则测试**：在配置正则表达式前，使用在线工具测试其正确性，避免误杀合法 Key

**注意事项：**

- 正则表达式必须是有效的正则表达式格式
- 建议使用 `^` 和 `$` 锚点，确保匹配整个 Key 字符串
- 配置正则后，建议先在测试项目中验证，确保不会误拦截合法 Key
- 如果正则表达式配置错误，可能导致所有 Key 都无法保存，请谨慎配置

## 常量校验正则

常量名称必须符合编程语言的标识符规范，否则会导致代码无法编译或产生运行时错误。TransX 提供常量校验正则功能，确保生成的常量文件符合语言规范。

**功能说明：**

配置常量校验正则后，在以下情况会自动执行校验：

1. **保存常量时**：在编辑区保存常量定义时
2. **生成常量文件时**：自动生成或更新常量文件时
3. **同步常量时**：从 .strings 文件同步到常量文件时

如果常量名不符合规范，系统会：
- 阻止保存或生成操作
- 显示详细的错误信息
- 指出不符合规范的具体原因

**Swift 常量命名规范：**

Swift 标识符规则：
- 必须以字母或下划线开头
- 可以包含字母、数字和下划线
- 不能使用 Swift 保留关键字
- 区分大小写

推荐的正则表达式：
```regex
^[a-zA-Z_][a-zA-Z0-9_]*$
```

常见命名风格：
```swift
// 驼峰命名（推荐）
let buttonOkKey = "button.ok"
let errorNetworkFailureKey = "error.network.failure"

// 下划线分隔
let button_ok_key = "button.ok"
let error_network_failure_key = "error.network.failure"

// 前缀风格
let kButtonOk = "button.ok"
let kErrorNetworkFailure = "error.network.failure"
```

**Objective-C 常量命名规范：**

Objective-C 标识符规则：
- 必须以字母或下划线开头
- 可以包含字母、数字和下划线
- 通常使用前缀避免命名冲突

推荐的正则表达式：
```regex
^[a-zA-Z_][a-zA-Z0-9_]*$
```

常见命名风格：
```objc
// 带前缀的驼峰命名（推荐）
NSString *const kAUUButtonOkKey = @"button.ok";
NSString *const kAUUErrorNetworkFailureKey = @"error.network.failure";

// 全大写下划线分隔（宏风格）
#define BUTTON_OK_KEY @"button.ok"
#define ERROR_NETWORK_FAILURE_KEY @"error.network.failure"
```

**不同编程语言的标识符规范对比：**

| 语言 | 首字符 | 其他字符 | 推荐风格 | 正则表达式 |
|------|--------|---------|---------|------------|
| Swift | 字母、_ | 字母、数字、_ | lowerCamelCase | `^[a-zA-Z_][a-zA-Z0-9_]*$` |
| Objective-C | 字母、_ | 字母、数字、_ | kPrefixCamelCase | `^[a-zA-Z_][a-zA-Z0-9_]*$` |
| Java | 字母、$、_ | 字母、数字、$、_ | lowerCamelCase | `^[a-zA-Z$_][a-zA-Z0-9$_]*$` |
| JavaScript | 字母、$、_ | 字母、数字、$、_ | lowerCamelCase | `^[a-zA-Z$_][a-zA-Z0-9$_]*$` |
| Python | 字母、_ | 字母、数字、_ | snake_case | `^[a-zA-Z_][a-zA-Z0-9_]*$` |

**常见错误示例：**

❌ 不符合规范的常量名：
```
123key          // 以数字开头
my-key          // 包含连字符
my.key          // 包含点号
my key          // 包含空格
class           // Swift/Objective-C 保留关键字
```

✅ 符合规范的常量名：
```
key123
myKey
my_key
_privateKey
kMyKey
```

**最佳实践：**

1. **统一命名风格**：在团队中统一常量命名风格，建议：
   - Swift 项目：使用小驼峰命名 + `Key` 后缀，如 `buttonOkKey`
   - Objective-C 项目：使用 `k` 前缀 + 驼峰命名，如 `kButtonOk`

2. **避免保留关键字**：检查常量名是否与语言关键字冲突，如 `class`、`import`、`return` 等

3. **长度限制**：建议限制常量名长度在 2-50 个字符之间，过短缺乏语义，过长影响可读性

4. **语义清晰**：常量名应清晰表达其对应的本地化内容的用途

5. **前缀管理**：对于大型项目，使用统一的前缀避免命名冲突，如 `l`（localization）或项目缩写

6. **正则测试**：配置正则表达式后，使用一些测试用例验证其正确性：
   ```
   测试用例：
   ✅ myKey
   ✅ _privateKey
   ✅ key123
   ❌ 123key
   ❌ my-key
   ❌ my.key
   ```

**注意事项：**

- 不同编程语言的标识符规则可能略有差异，配置时需根据项目使用的语言调整
- 正则表达式不应过于严格，否则可能限制合法的常量名
- 建议在正则中明确排除语言保留关键字，避免生成无法编译的代码
- 如果项目同时使用 Swift 和 Objective-C，建议配置兼容两种语言的正则表达式

## 隐藏文件

在实际的 iOS/macOS 开发中，项目可能包含多种类型的 .strings 文件，但并非所有文件都需要日常维护。隐藏文件功能允许您选择性地隐藏某些 .strings 文件，使界面更加简洁，聚焦于核心的本地化内容。

**功能说明：**

TransX 会自动扫描项目中所有的 .strings 文件，并在此列表中展示。您可以勾选需要隐藏的文件，隐藏后：

- **导航区不显示**：在主窗口的导航区不会列出这些文件
- **快捷键跳过**：使用快捷键切换文件时会跳过隐藏的文件
- **搜索排除**：全局搜索时默认不包含隐藏文件的内容
- **统计排除**：项目统计信息中不计入隐藏文件的数据

**常见需要隐藏的文件类型：**

1. **Info.plist 本地化文件**：
   - `InfoPlist.strings`
   - 包含应用名称、权限描述等系统级本地化
   - 通常很少修改，可以隐藏

2. **Storyboard/XIB 本地化文件**：
   - `Main.strings`
   - `LaunchScreen.strings`
   - 如果使用代码方式管理 UI 文本，storyboard 的本地化文件可能为空或不需要维护

3. **第三方框架的本地化文件**：
   - 某些第三方 SDK 自带的 .strings 文件
   - 通常不需要修改，可以隐藏

4. **系统生成的本地化文件**：
   - 由 Xcode 自动生成的临时或缓存文件
   - 不应手动编辑的文件

5. **已废弃的本地化文件**：
   - 旧版本遗留的 .strings 文件
   - 计划删除但暂时保留的文件

**使用场景：**

- **简化界面**：隐藏不常用的文件，使导航区更加清爽
- **聚焦核心**：专注于主要的本地化文件，如 `Localizable.strings`
- **新手友好**：对于新加入项目的团队成员，隐藏复杂的文件可降低学习成本
- **避免误操作**：隐藏不应该修改的系统文件，防止误编辑

**最佳实践：**

1. **保持核心文件可见**：确保 `Localizable.strings` 等核心本地化文件始终可见

2. **定期审查隐藏列表**：随着项目演进，定期检查隐藏列表，移除已删除的文件，添加新的不需要关注的文件

3. **团队同步**：如果使用版本控制管理 TransX 配置，确保团队成员的隐藏文件列表一致

4. **文档说明**：在项目文档中说明哪些文件被隐藏及原因，避免新成员困惑

5. **不隐藏活跃文件**：不要隐藏需要经常编辑的文件，即使它们看起来不重要

**注意事项：**

- 隐藏文件不等于删除文件，文件仍然存在于项目中，只是在 TransX 界面中不显示
- 如果不确定是否应该隐藏某个文件，建议先保持可见，观察一段时间后再决定
- 可以随时取消隐藏，重新显示之前隐藏的文件

## 同步创建

同步创建功能能够在多个本地化文件之间保持一致性，当您在某一个语言的 .strings 文件中创建新的本地化条目时，TransX 会自动在其他语言的对应文件中创建相同的条目。

**功能说明：**

启用同步创建后，当您在某个 .strings 文件中添加新的本地化字符串时：

1. **自动同步到其他语言**：系统会在所有已配置的语言文件中创建相同 Key 的条目
2. **智能分组**：优先将新条目添加到目标文件的同名分组中
3. **备选位置**：如果目标文件中没有同名分组，则添加到第一个分组中
4. **保持结构**：尽可能保持不同语言文件之间的结构一致性

**工作流程：**

```
步骤 1：在中文 Localizable.strings 中创建新条目
"app.settings.title" = "设置";

步骤 2：TransX 自动在其他语言文件中创建对应条目
英文："app.settings.title" = "Settings";
日文："app.settings.title" = "設定";
韩文："app.settings.title" = "설정";

步骤 3：如果其他语言的值未填写，会：
- 显示为空或显示基础语言的值（取决于配置）
- 在列表中标记为"待翻译"状态
- 记录在待办事项中，提醒需要翻译
```

**分组匹配规则：**

1. **优先同名分组**：
   ```
   中文文件（zh-Hans）：
   /* 设置相关 */
   "app.settings.title" = "设置";
   
   英文文件（en）：
   /* Settings */  ← 不同名称，不匹配
   
   /* 设置相关 */  ← 同名，匹配成功
   "app.settings.title" = "Settings";  ← 添加到这里
   ```

2. **备选第一个分组**：
   ```
   英文文件（en）：
   /* General */  ← 第一个分组
   "app.settings.title" = "Settings";  ← 如果没有同名分组，添加到这里
   
   /* User */
   ...
   ```

**适用范围：**

✅ 同步创建适用于：
- 创建全新的本地化 Key

❌ 同步创建不适用于：
- 修改现有 Key 的值
- 修改现有 Key 的名称
- 删除现有的本地化条目
- 移动条目到不同的分组

**注意事项：**

- **仅对新建内容生效**：修改现有内容时不会触发同步，避免意外覆盖其他语言的翻译
- **检查文件权限**：确保所有目标语言文件都可写，否则同步可能失败
- **注意文件冲突**：如果使用版本控制，同步创建可能导致多个文件同时变更，提交前请仔细检查