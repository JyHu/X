# 移动到...

![](./imgs/img28.png)

## 功能概述

"移动到..."功能用于在同一项目的不同 .strings 文件之间转移本地化条目。与"复制到"功能的根本区别在于:移动操作会从源文件中删除条目,并将其添加到目标文件中,实现条目的完全迁移而非复制。该功能特别适合修正文件归属错误、项目结构重组或模块化拆分等场景,是管理多文件本地化项目的重要工具。

## 工作原理

### 移动操作的完整流程

1. **读取源数据**：从源文件中读取选中条目的完整信息（Key、所有语言翻译、常量等）
2. **写入目标**：将条目数据写入目标 .strings 文件
3. **删除源数据**：从源文件中删除该条目
4. **更新索引**：更新两个文件的内部索引和元数据
5. **标记修改**：将两个文件都标记为已修改状态

### 原子性保证

TransX 会尽量保证移动操作的原子性：
- 如果目标文件写入失败，源文件不会删除条目
- 如果操作中断，会尽量保持数据一致性
- 建议移动前保存当前更改，并使用版本控制

## 使用场景详解

### 场景 1：修正文件归属错误

**背景**：
项目中有 `Localizable.strings`（主应用）和 `Widget.strings`（小组件）两个文件。开发人员在快速开发时，忘记切换文件，直接在 `Localizable.strings` 中创建了几条本应属于小组件的文案。

**传统处理方式的问题**：
1. 在 Widget.strings 中重新创建这几条
   - 需要重新输入所有 Key
   - 需要重新输入或复制所有语言的翻译
   - 容易出错，特别是有很多条目时
   - 浪费时间
2. 从 Localizable.strings 中删除
   - 如果已经有翻译，删除会造成工作浪费
   - 删除后找不回，风险较大

**使用"移动到..."的解决方案**：
1. 在 `Localizable.strings` 中选中误创建的条目
2. 右键选择"移动到..."
3. 在弹出的文件列表中选择 `Widget.strings`
4. 确认操作
5. 条目立即从 Localizable.strings 消失，出现在 Widget.strings 中
6. 所有翻译内容完整保留，无需重新输入

**优势**：
- 一步到位，无需重复工作
- 数据完整性有保障
- 避免手工复制粘贴的错误
- 节省时间和精力

### 场景 2：模块化重构

**背景**：
应用进行架构重构，原本在 `Localizable.strings` 中的设置相关文案需要独立到 `Settings.strings` 文件中。

**操作流程**：
1. 创建新的 `Settings.strings` 文件并添加到项目
2. 在 TransX 中刷新项目，识别新文件
3. 在 `Localizable.strings` 中筛选或搜索所有设置相关的条目
   - 可以搜索 Key 中包含 "settings" 的条目
   - 或按分组筛选出设置分组的所有条目
4. 全选这些条目
5. 使用"移动到..."功能，选择 `Settings.strings` 作为目标
6. 确认操作
7. 验证移动成功：
   - 在 Localizable.strings 中这些条目已不存在
   - 在 Settings.strings 中可以找到所有移动的条目
   - 翻译内容完整无损

**收益**：
- 代码模块化，每个模块有独立的本地化文件
- 便于不同团队独立维护各自模块的本地化
- 减少单个文件的条目数量，提高管理效率
- 支持按模块编译和加载本地化资源

### 场景 3：扩展分离

**背景**：
最初应用和扩展（Extension）共享同一个 Localizable.strings，后来发现扩展和主应用需要独立的本地化文件。

**目标**：
将扩展专用的本地化条目从主应用的文件移动到扩展的专属文件。

**操作流程**：
1. 为扩展创建独立的 .strings 文件（如 `ShareExtension.strings`）
2. 识别哪些条目是扩展专用的
   - 可以通过 Key 前缀识别（如 `share.`）
   - 或查看代码引用
3. 选中这些扩展专用的条目
4. 使用"移动到..."移动到扩展的 .strings 文件
5. 更新扩展的代码引用配置

**技术考虑**：
- 扩展和主应用是独立的 Bundle，本地化文件也应独立
- 移动后需要确保扩展能正确加载新的 .strings 文件
- 如果有共享的文案，应该在两个文件中都保留（使用"复制到"而非"移动到..."）

### 场景 4：废弃功能清理

**背景**：
应用移除了某个功能，相关的本地化条目需要从主文件移到归档文件。

**操作流程**：
1. 创建 `Deprecated.strings` 归档文件
2. 识别废弃功能相关的所有本地化条目
3. 使用"移动到..."将它们移到归档文件
4. 保留归档文件在项目中，但不包含在编译目标中

**优势**：
- 保留历史数据，便于未来可能的功能恢复
- 清理主文件，保持整洁
- 便于统计和分析废弃内容

### 场景 5：环境分离

**背景**：
开发环境、测试环境、生产环境使用不同的文案。

**组织方式**：
- `Localizable.strings`：生产环境文案
- `Localizable_Debug.strings`：开发测试环境专用文案
- 根据编译配置加载不同的文件

**操作流程**：
当某些调试文案需要移到生产环境时，使用"移动到..."功能在不同环境文件间转移。

## 操作步骤详解

### 标准移动流程

1. **确认源文件**：
   - 在导航区选择包含要移动内容的源 .strings 文件
   - 确保文件已加载并显示在内容区

2. **选择条目**：
   - 在内容列表中选中一条或多条要移动的条目
   - 使用 `Command + 点击` 多选不连续的条目
   - 使用 `Shift + 点击` 选择连续的多条
   - 可以使用搜索或筛选功能先定位目标条目

3. **执行移动**：
   - 在选中的条目上右键点击
   - 选择"移动到..."菜单项
   - 在弹出的对话框中查看可用的目标文件列表

4. **选择目标文件**：
   - 从列表中选择目标 .strings 文件
   - 对话框会显示每个文件的路径、当前条目数等信息
   - 确认选择了正确的目标文件

5. **处理冲突**（如果有）：
   - 如果目标文件中已存在相同的 Key，会弹出冲突处理对话框
   - 选择合适的处理方式（跳过、覆盖、重命名等）

6. **确认操作**：
   - 移动内容后，移动结果会在日志区显示

7. **验证结果**：
   - 在源文件中确认条目已被删除
   - 切换到目标文件，确认条目已成功添加
   - 检查所有语言的翻译是否都已正确移动
   - 检查注释、常量等附加信息是否完整

### 批量移动技巧

**使用搜索**：
1. 搜索需要移动的条目（如 Key 包含 "widget"）
2. 在搜索结果中全选
3. 执行移动操作

**使用筛选**：
1. 应用筛选条件
2. 在筛选结果中选择条目
3. 批量移动

**使用暂存区**：
1. 从不同位置将需要移动的条目加入暂存区
2. 在暂存区中全选
3. 统一移动到目标文件

## Key 冲突处理

### 冲突场景

当目标文件中已存在相同 Key 的条目时，会发生冲突。

### 处理选项

**1. 跳过（Skip）**：
- 不移动此条目，保留在源文件中
- 目标文件中的现有条目保持不变
- 适用于：确认目标文件的版本是正确的

**2. 覆盖（Overwrite）**：
- 用源文件的条目覆盖目标文件中的现有条目
- 源文件中删除该条目
- 目标文件中的旧条目被完全替换
- 适用于：确认源文件的版本是正确的，需要更新目标

**3. 重命名（Rename）**：
- 为移动的条目生成新的 Key（如添加后缀 `_moved`）
- 两个版本的条目都保留
- 适用于：需要保留两个版本，稍后手动合并

## 与"复制到"功能的对比

| 特性 | 移动到... | 复制到 |
|-----|----------|-------|
| 源文件变化 | **删除条目** | 保留条目 |
| 目标文件变化 | 添加条目 | 添加条目 |
| 数据完整性 | 完整转移 | 完整复制 |
| 适用场景 | **纠错、重组、归档** | 复用、共享 |
| Key 冲突处理 | 需要处理 | 需要处理 |
| 可撤销性 | 需要移动回去 | 删除目标文件中的条目 |
| 风险程度 | **较高（删除源数据）** | 较低（源数据保留） |

### 选择建议

**使用"移动到..."的情况**：
- 条目属于错误的文件，需要纠正
- 项目重组，条目需要转移归属
- 废弃功能，需要归档文案
- 确定内容只应存在于一个文件中

**使用"复制到"的情况**：
- 内容需要在多个文件中同时存在
- 主应用和扩展需要相同的文案
- 创建备份或模板
- 不确定是否应该删除源文件中的内容

**安全建议**：
- 如果不确定，先使用"复制到"，验证后再手动删除源文件中的条目
- 在进行大规模移动前，先提交当前更改到版本控制系统
- 对于关键项目，先在测试分支上操作，验证后再应用到主分支

## 注意事项

1. **不可逆性**：移动操作会删除源文件中的条目，虽然可以移回，但如果没有版本控制，删除是不可逆的
2. **保存提醒**：移动操作会同时修改源文件和目标文件，都需要保存
3. **版本控制必备**：强烈建议在移动前提交当前更改到 Git 等版本控制系统
4. **Key 冲突风险**：移动前检查目标文件是否已有相同的 Key，避免不必要的冲突
5. **代码引用影响**：移动后，如果代码中使用了不同的 Bundle 加载不同的 .strings 文件，需要更新代码引用
6. **翻译完整性**：移动后检查目标文件中的条目是否有缺失的翻译
7. **权限检查**：确保源文件和目标文件都可写且未被其他程序锁定
8. **大量移动耗时**：移动数百条记录时可能需要较长时间，请耐心等待
9. **原子性限制**：虽然 TransX 尽量保证操作的原子性，但在极端情况下（如程序崩溃）可能导致数据不一致
10. **团队同步**：在团队协作中，移动操作后记得及时同步给团队成员，避免版本冲突

## 最佳实践

### 移动前的准备工作

1. **备份数据**：
   - 提交当前更改到版本控制系统
   - 或手动备份相关的 .strings 文件
   - 记录移动前的文件状态（条目数量等）

2. **规划移动方案**：
   - 明确哪些条目需要移动
   - 确定目标文件
   - 预判可能的 Key 冲突

3. **评估影响范围**：
   - 检查代码中是否有对这些 Key 的引用
   - 确认移动后代码是否需要调整
   - 评估对翻译工作流的影响

### 移动操作中

1. **小批量验证**：
   - 先移动少量条目进行验证
   - 确认移动正确后再批量操作
   - 避免一次性移动过多导致难以回退

2. **处理冲突时谨慎**：
   - 仔细对比冲突的内容
   - 不确定时选择"跳过"或"重命名"
   - 避免盲目选择"覆盖"

3. **及时保存**：
   - 每完成一批移动就保存
   - 避免因意外导致数据丢失

### 移动后的验证

1. **数据完整性检查**：
   - 在源文件中确认条目已删除
   - 在目标文件中确认条目已添加
   - 检查所有语言的翻译都已正确移动
   - 验证注释、常量等附加信息

2. **功能测试**：
   - 运行应用，测试移动的本地化内容是否正常显示
   - 测试不同语言环境
   - 确认没有因文件归属变化导致的问题

3. **代码审查**：
   - 如果涉及代码引用的变化，进行代码审查
   - 确保所有引用都已正确更新

4. **文档更新**：
   - 更新项目文档，说明文件结构的变化
   - 记录移动操作的原因和影响
   - 通知团队成员

### 异常情况处理

**如果移动后发现错误**：
1. 不要继续操作，避免问题扩大
2. 如果刚移动且未保存，可以关闭文件不保存
3. 如果已保存，使用版本控制回退
4. 或手动将条目移回原文件

**如果出现冲突无法解决**：
1. 取消当前操作
2. 手动分析冲突原因
3. 可能需要先清理目标文件中的重复条目
4. 或者调整移动策略

## 团队协作建议

### 沟通机制

在进行文件间移动前：
1. 在团队会议或群组中提前通知
2. 说明移动的原因和影响范围
3. 确保没有其他成员正在编辑相关文件
4. 约定移动操作的时间窗口

### 版本控制策略

1. **独立提交**：
   - 移动操作单独提交，不与其他修改混在一起
   - Commit message 清晰说明移动了哪些内容
   - 例如："Move widget-related localization from Localizable.strings to Widget.strings"

2. **分支操作**（大规模移动）：
   - 在单独的分支上进行移动操作
   - 测试验证后再合并到主分支
   - 避免直接在主分支上进行高风险操作

3. **代码审查**：
   - 移动操作的 PR 需要团队审查
   - 确认移动的合理性
   - 检查是否有遗漏或错误

### 权限管理

- 限制谁可以进行跨文件移动操作
- 关键文件的移动需要更高权限
- 记录移动操作的执行者和时间