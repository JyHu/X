# 复制到

![](./imgs/img26.png)

## 功能概述

复制到功能是 TransX 中用于在同一项目的不同 .strings 文件之间进行本地化内容迁移和复用的专业工具。该功能支持将一个或多个本地化条目（包括其 Key、所有语言的翻译、注释和常量信息）完整地复制到目标 .strings 文件中，实现跨文件的内容共享和重用。

**核心价值**：
- **避免重复劳动**：无需在目标文件中重新创建相同的 Key 和翻译
- **保持翻译一致性**：确保相同文案在不同文件中使用统一的翻译
- **加速模块化开发**：支持快速构建独立模块的本地化资源
- **降低错误风险**：自动化复制减少手工输入导致的错误

该功能特别适用于模块化项目、应用扩展开发、通用文案库建设等场景。

## 工作原理

在 iOS/macOS 开发中，一个项目可能包含多个 .strings 文件，用于不同的模块或功能：

- `Localizable.strings`：应用的主要本地化文件
- `Settings.strings`：设置页面的本地化文件
- `InfoPlist.strings`：应用信息和权限描述的本地化文件
- `Widget.strings`：小组件的本地化文件
- 各种自定义的模块化 .strings 文件

复制到功能允许在这些文件之间共享本地化内容，避免重复劳动。

## 使用场景

### 场景 1：通用文案复用

**背景**：
项目中有 `Localizable.strings`（主应用）和 `Widget.strings`（小组件）两个文件。在主应用中创建了"确定"、"取消"、"关闭"等通用按钮文案，小组件中也需要使用这些文案。

**操作流程**：
1. 在导航区选择 `Localizable.strings` 文件
2. 在内容列表中选中需要复用的条目（如"确定"、"取消"、"关闭"）
3. 右键点击选中的条目，选择"复制到"菜单项
4. 在弹出的文件列表中选择 `Widget.strings`
5. 确认操作，所选条目及其所有语言翻译会被复制到目标文件
6. 切换到 `Widget.strings` 验证内容已成功复制

**优势**：
- 避免在 Widget.strings 中重新创建相同的 Key
- 自动复制所有语言的翻译，无需逐个语言处理
- 确保不同文件中相同文案的翻译一致性

### 场景 2：模块拆分

**背景**：
原本所有本地化内容都在 `Localizable.strings` 中，现在要将设置相关的内容拆分到独立的 `Settings.strings` 文件中。

**操作流程**：
1. 创建新的 `Settings.strings` 文件并添加到项目
2. 在 TransX 中刷新项目，识别新文件
3. 在 `Localizable.strings` 中筛选或搜索所有设置相关的条目
4. 全选这些条目
5. 使用"复制到"功能，将它们复制到 `Settings.strings`
6. 验证复制成功后，可以选择性地从原文件中删除这些条目

### 场景 3：扩展与主应用共享文案

**背景**：
应用添加了Today Extension、Share Extension、App Clip 等扩展，这些扩展需要使用主应用中的部分本地化文案。

**操作流程**：
1. 为每个扩展创建独立的 .strings 文件
2. 识别扩展需要使用的文案（如网络错误提示、通用按钮等）
3. 从主应用的 Localizable.strings 中选择这些条目
4. 使用"复制到"功能分别复制到各个扩展的 .strings 文件中

**注意事项**：
由于扩展和主应用运行在不同的进程中，即使文案相同，也需要在各自的 .strings 文件中独立存在。

### 场景 4：快速修正创建错误

**背景**：
开发人员在快速开发时，忘记切换 .strings 文件，在文件 A 中创建了几条本应属于文件 B 的条目。

**传统方式的问题**：
- 切换到文件 B 重新创建，需要重新输入所有 Key 和翻译
- 如果已经有部分翻译完成，删除会造成工作浪费
- 需要记住所有的 Key 和对应的翻译内容

**使用"复制到"的解决方案**：
1. 选中误创建在文件 A 中的条目
2. 使用"复制到"功能将它们复制到正确的文件 B
3. 验证复制成功后，从文件 A 中删除这些条目

## 操作步骤

### 标准操作流程

1. **确认源文件**：
   - 在导航区选择包含要复制内容的源 .strings 文件
   - 确保文件已加载并显示在内容区

2. **选择条目**：
   - 在内容列表中选中一条或多条要复制的条目
   - 使用 `Command + 点击` 多选不连续的条目
   - 使用 `Shift + 点击` 选择连续的多条
   - 可以使用搜索或筛选功能先定位目标条目

3. **执行复制**：
   - 在选中的条目上右键点击
   - 选择"复制到"菜单项
   - 在弹出的对话框中查看可用的目标文件列表

4. **选择目标**：
   - 从列表中选择目标 .strings 文件
   - 确认选择正确的目标文件

5. **验证结果**：
   - 切换到目标文件
   - 查找刚复制的条目，确认内容完整
   - 检查所有语言的翻译是否都已复制

## Key 冲突处理

在 .strings 文件中，每个 Key 必须是唯一的。复制操作会检查目标文件中是否已存在相同的 Key：

### 冲突检测

**情况 1：Key 不存在**
- 直接复制条目及其所有数据到目标文件
- 这是最常见和最安全的情况

**情况 2：Key 已存在**
- TransX 会检测到 Key 冲突
- 弹出冲突处理对话框，提供以下选项：
  - **跳过**：不复制此条目，保留目标文件中的原有内容
  - **覆盖**：用源文件的内容覆盖目标文件中的现有条目
  - **重命名**：为复制的条目生成新的 Key（如添加后缀 `_copy`）

### 数据完整性保证

复制操作会确保以下数据的完整性：
- **Key 值**：原样复制
- **所有语言的翻译**：包括项目中配置的所有语言
- **常量名称**：如果源条目有常量，也会一起复制

## 与"移动到..."功能的区别

| 特性 | 复制到 | 移动到... |
|-----|-------|-----------|
| 源文件变化 | 保留原条目 | 删除原条目 |
| 目标文件变化 | 添加新条目 | 添加新条目 |
| 适用场景 | 内容复用、共享 | 重组、纠错 |
| Key 冲突 | 需要处理冲突 | 需要处理冲突 |
| 可撤销性 | 可以删除目标文件中的条目 | 需要再移动回去 |

**选择建议**：
- 如果内容需要在多个文件中同时存在，使用"复制到"
- 如果内容应该从一个文件转移到另一个文件，使用"移动到..."

## 注意事项

1. **保存提醒**：复制操作会修改目标文件，记得及时保存
2. **版本控制**：复制大量内容前，建议先提交当前更改，便于回退
3. **Key 冲突**：复制前可以先检查目标文件是否已存在相同的 Key
4. **翻译完整性**：复制后检查目标文件中的条目是否有缺失的翻译
5. **分组归属**：复制的条目在目标文件中会进入默认分组或保持原分组（如果目标文件有同名分组）
6. **权限检查**：确保目标文件可写且未被其他程序锁定
7. **大量复制**：复制数百条记录时可能需要较长时间，请耐心等待
8. **代码引用**：如果复制的 Key 原本只在一个模块中使用，复制到其他文件后注意代码引用关系
9. **文件同步**：在团队协作中，复制操作后记得同步给团队成员
10. **备份建议**：对于重要项目，复制大量数据前建议备份 .strings 文件

## 最佳实践

1. **规划文件结构**：提前规划好各个 .strings 文件的职责范围，减少频繁复制的需要
2. **建立通用库**：创建一个专门的 `Common.strings` 文件，存放各处都可能用到的通用文案
3. **定期整理**：定期检查各文件间是否有重复的 Key，考虑是否需要合并或拆分
4. **命名规范**：使用有意义的 Key 前缀区分不同模块，如 `widget.`, `settings.`, `main.`
5. **文档记录**：在项目文档中说明各 .strings 文件的用途和它们之间的关系
6. **验证测试**：复制后在各个模块中测试本地化内容是否正确显示
7. **增量复制**：优先使用增量复制而非全量复制，避免不必要的冲突
8. **冲突预防**：复制前先搜索目标文件，确认 Key 不存在